<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Thêm viewport để tối ưu hóa di động -->
    <title>越南语听力练习</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            text-align: center; 
            margin: 0; 
            padding-bottom: 300px; /* Mặc định cho màn hình lớn */
            background-color: #f7fbf3; /*f7fbf3  3f4040*/
        }
        #gameContainer {
            display: block;
            min-height: calc(100vh - 150px); /* Đảm bảo nội dung chiếm đủ chiều cao màn hình */
        }
        #infoBox { 
            width: 95%; 
            max-width: 700px;
            min-height: 100px; 
            margin: 0 auto; 
            border: 2px solid #91b66f; /*041b31 1f4263*/
            background: #85ae5f; /*ecf2e4 fefefc*/
            color: #ffffff; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: clamp(40px, 5vw, 60px);
            font-weight: bold;
        }
        #contactBox { 
            width: 90%; 
            max-width: 700px;
            min-height: 25px; 
            margin: 0px auto; 
            border: 2px solid #91b66f; 
            background: #85ae5f; 
            color: #f1c232; 
            display: flex; 
            align-items: center; 
            justify-content: left; 
            padding-left: 20px;
            font-size: clamp(16px, 2vw, 20px); 
            font-weight: bold;
        }
        #instructionBox { 
            width: 90%; 
            max-width: 700px;
            min-height: 25px; 
            margin: 0px auto; 
            border: 2px solid #91b66f; 
            background: #85ae5f; 
            color: #f7e19c; 
            display: flex; 
            align-items: center; 
            justify-content: left; 
            padding-left: 20px;
            font-size: clamp(16px, 2vw, 20px); 
            font-weight: bold;
        }
        #controls { 
            position: fixed; /* Cố định ở cuối màn hình */
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 95%;
            max-width: 800px; /* Giới hạn chiều rộng tối đa */
            background: #f7fbf3;
                        border: 3px solid #f7fbf3;                        
            padding: 10px 0; 
           /* box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.2); */
            z-index: 1000; 
        }
        #controls div {
            margin: 5px 0; 
            display: flex;
            justify-content: center;
            align-items: center;
        }
        button { 
            padding: 8px 8px; 
            margin: 0 5px; 
            cursor: pointer; 
            border: 2px solid #85ae5f; 
            background: #85ae5f; /*192332*/
                        box-shadow: 0 5px 5px rgba(0, 0, 0, 0.2);
            color: #fffbef; 
            font-size: 28px; 
            border-radius: 5px; 
        }
        #sentenceNumber { 
            width: 50px; 
            padding: 10px; 
            text-align: center; 
            border: 3px solid #85ae5f; /*041b31 68838B*/
            background: #f1cc76; 
            color: #000; 
            border-radius: 10px; 
            font-size: 16px; 
            -moz-appearance: textfield; 
        }
        #sentenceNumber::-webkit-inner-spin-button, 
        #sentenceNumber::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
        #sentenceNumber:disabled { 
            background: #eee; 
        }
        .disabled { 
            cursor: not-allowed; 
            pointer-events: none; 
        }
        .active-mode { 
            border: 2px solid #fed16a; 
        }
        #indicator { 
            width: 95%;
                        max-width: 700px; 
            min-height: 50px; 
            margin: 10px auto; 
                        padding: 5px;
            border: 3px solid #fed16a; 
            background: #ffffe0; 
            border-radius: 10px; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
        }
        #optionsContainer {
            width: 100%;
            max-width: 700px;
            margin: 10px auto;
        }
        .optionBtn {
            width: 95%; 
            max-width: 700px;
            padding: 10px;
            margin: 5px 0;
            border: 2px solid #ffffff;
            background: #ffffff; /*E6EDD9*/
            color: #000000;
                        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            font-size: 30px;
            text-align: left;
            cursor: pointer;
            border-radius: 5px;
        }
        .optionBtn:hover {
            background: #D2E4C4;
        }
        .correct {
            background: #B7D7AA !important;
        }
        .wrong {
            background: #CE6D5E !important;
        }
        #score { 
            display: none; 
            width: 100%;
            max-width: 700px;
            margin: 10px auto; 
            color: #FF6820; 
            font-size: 30px; 
            text-align: center;
        }
        #wrongSentences { 
            display: none; 
            width: 95%; 
            max-width: 700px; 
            margin: 10px auto; 
            padding: 10px; 
            border: 2px solid #CE6D5E; 
            background: #FFF0F0; 
            color: #CE6D5E; 
            font-size: 30px; 
            text-align: left; 
            border-radius: 5px; 
        }
        #results { 
            display: none; 
            width: 95%;
            max-width: 700px;        
            margin: 10px auto; 
            padding: 10px; 
            border: 2px solid #734A2E; 
            background: #fffbef; 
            color: #000; 
            font-size: 30px; 
            text-align: left; 
            border-radius: 5px; 
            white-space: pre-line;
        }

        /* Media query cho thiết bị di động */
        @media (max-width: 768px) {
            body {
                padding-bottom: 200px; /* Giảm padding-bottom cho điện thoại */
            }
            #controls {
                padding: 5px 0; /* Giảm padding */
            }
            button {
                padding: 6px 6px; /* Giảm kích thước nút */
                font-size: 20px; /* Giảm kích thước chữ */
            }
            #sentenceNumber {
                width: 40px; /* Giảm chiều rộng */
                padding: 8px; /* Giảm padding */
                font-size: 14px; /* Giảm kích thước chữ */
            }
            .optionBtn {
                font-size: 20px; /* Giảm kích thước chữ cho đáp án */
                padding: 8px; /* Giảm padding */
            }
            #infoBox {
                font-size: clamp(30px, 4vw, 40px); /* Giảm kích thước chữ */
            }
            #contactBox, #instructionBox {
                font-size: clamp(14px, 2vw, 16px); /* Giảm kích thước chữ */
            }
            #indicator {
                min-height: 40px; /* Giảm chiều cao tối thiểu */
            }
            #results, #wrongSentences, #score {
                font-size: 24px; /* Giảm kích thước chữ */
                                width: 90%;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="infoBox">习得越南语<br>听力练习</div>
        <div id="contactBox">讲师-阮玉煌 | Weixin：XiDeYueNanYu</div>
        <div id="instructionBox">选择与播放内容相符的选项</div>
        <div id="indicator"></div>
        <div id="optionsContainer"></div>
        <div id="results"></div>
        <div id="score">0/0</div>
        <div id="wrongSentences"></div>
    </div>
    <div id="controls">
        <div>
            <button id="freeModeBtn" class="active-mode">自由模式</button>
            <button id="testModeBtn">作业模式</button>
        </div>
        <div>
            <button id="autoContinueBtn">自动继续</button>
            <button id="showHideBtn">显示-隐藏</button>
        </div>
        <div>
            <button id="prevBtn">◀</button>
            <input type="text" id="sentenceNumber" inputmode="numeric" pattern="[0-9]*">
            <button id="nextBtn">▶</button>
            <button id="replayBtn">再听一遍</button>
        </div>
    </div>
    <audio id="mainAudio" src="audio.mp3"></audio>
    <audio id="correctAudio" src="Dung.mp3"></audio>
    <audio id="wrongAudio" src="Sai.mp3"></audio>

    <script>
        const audio = document.getElementById('mainAudio');
        const correctAudio = document.getElementById('correctAudio');
        const wrongAudio = document.getElementById('wrongAudio');
        const indicator = document.getElementById('indicator');
        const sentenceNumber = document.getElementById('sentenceNumber');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const replayBtn = document.getElementById('replayBtn');
        const freeModeBtn = document.getElementById('freeModeBtn');
        const testModeBtn = document.getElementById('testModeBtn');
        const autoContinueBtn = document.getElementById('autoContinueBtn');
        const showHideBtn = document.getElementById('showHideBtn');
        const scoreDisplay = document.getElementById('score');
        const wrongSentencesDisplay = document.getElementById('wrongSentences');
        const optionsContainer = document.getElementById('optionsContainer');
        const resultsDisplay = document.getElementById('results');

        const buttons = [prevBtn, nextBtn, replayBtn, freeModeBtn, testModeBtn, autoContinueBtn, showHideBtn];

const sentences = [
    {
        "audioFile": "audio.mp3",
        "start": 0.248917,
        "end": 1.888917,
        "correctAnswer": "Cậu ấy đang làm gì?",
        "translation": "他正在做什么？",
        "options": [
            "Cậu ẩy đang làm gì?",
            "Cậu ấy đang lằm gì?",
            "Cẩu ấy đang làm gì?",
            "Cậu ấy đang làm gì?"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 2.618917,
        "end": 4.268917,
        "correctAnswer": "Cậu ấy đang chơi game.",
        "translation": "他正在玩游戏。",
        "options": [
            "Cậu ấy đang chơi gam.",
            "Cậu ấy đang chời game.",
            "Cậu ẩy đang chơi game.",
            "Cậu ấy đang chơi game."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 5.348917,
        "end": 6.888917,
        "correctAnswer": "Anh ấy làm gì đấy?",
        "translation": "他在做什么呢？",
        "options": [
            "Anh ấy làm gì đáy?",
            "Anh ấy làm dì đấy?",
            "Ánh ấy làm gì đấy?",
            "Anh ấy làm gì đấy?"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 7.478917,
        "end": 9.178917,
        "correctAnswer": "Anh ấy đang câu cá.",
        "translation": "他正在钓鱼。",
        "options": [
            "Anh ấy đang câu gá.",
            "Anh ấy đang câu cả.",
            "Anh ẩy đang câu cá.",
            "Anh ấy đang câu cá."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 10.168917,
        "end": 11.308917,
        "correctAnswer": "Em làm gì đấy?",
        "translation": "你在做什么呢？",
        "options": [
            "Em làm gì đáy?",
            "Em làm gì đấy?",
            "Em làm dì đấy?",
            "Em lằm gì đấy?"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 11.888917,
        "end": 13.388917,
        "correctAnswer": "Em đang đi xe đạp.",
        "translation": "我正在骑自行车。",
        "options": [
            "Em đang đi se đạp.",
            "Em đang đi xe đạp.",
            "Em đang đi xê đạp.",
            "Em đang đi xe đap."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 14.268917,
        "end": 15.948917,
        "correctAnswer": "Chị ấy đang làm gì?",
        "translation": "她正在做什么？",
        "options": [
            "Chị ấy đang làm gí?",
            "Chị ấy đang lằm gì?",
            "Chị ẩy đang làm gì?",
            "Chị ấy đang làm gì?"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 16.628917,
        "end": 18.198917,
        "correctAnswer": "Chị ấy đang nghe nhạc.",
        "translation": "她正在听音乐。",
        "options": [
            "Chị ấy đang nghê nhạc.",
            "Chị ấy đang nghe nhác.",
            "Chị ấy đang nghe nhạc.",
            "Chị ấy đang nge nhạc."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 19.328917,
        "end": 21.138917,
        "correctAnswer": "Bà ấy đang làm gì đấy?",
        "translation": "她正在做什么呢？",
        "options": [
            "Bà ấy đang làm gì đáy?",
            "Bà ẩy đang làm gì đấy?",
            "Bà ấy đang lằm gì đấy?",
            "Bà ấy đang làm gì đấy?"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 21.708917,
        "end": 23.978917,
        "correctAnswer": "Bà ấy đang nói chuyện ở hành lang.",
        "translation": "她正在走廊上说话。",
        "options": [
            "Bà ấy đang nói chuyện ở hành lăng.",
            "Bà ấy đang nói truyện ở hành lang.",
            "Bà ấy đang nói chuyện ở hành lang.",
            "Bà ẩy đang nói chuyện ở hành lang."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 24.938917,
        "end": 26.638917,
        "correctAnswer": "Ông ấy đang làm gì?",
        "translation": "他正在做什么？",
        "options": [
            "Ông ấy đang làm gí?",
            "Ông ấy đang lằm gì?",
            "Ông ẩy đang làm gì?",
            "Ông ấy đang làm gì?"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 27.438917,
        "end": 29.878917,
        "correctAnswer": "Ông ấy đang đọc sách tại thư phòng.",
        "translation": "他正在书房看书。",
        "options": [
            "Ông ấy đang đọc sách tại thư phòng.",
            "Ông ấy đang đọc sác tại thư phòng.",
            "Ông ấy đang dọc sách tại thư phòng.",
            "Ông ẩy đang đọc sách tại thư phòng."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 31.028917,
        "end": 32.398917,
        "correctAnswer": "Bạn đang ở đâu?",
        "translation": "你在哪里？",
        "options": [
            "Bạn đang ở dâu?",
            "Bạn đang ỏ đâu?",
            "Bạn đang ở đâu?",
            "Bản đang ở đâu?"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 32.918917,
        "end": 34.918917,
        "correctAnswer": "Mình đang nấu ăn ở nhà bếp.",
        "translation": "我正在厨房做饭。",
        "options": [
            "Mình đang nấu ăn ở nhá bếp.",
            "Mình đang nấu ăn ỏ nhà bếp.",
            "Mình đang nấu ăn ở nhà bếp.",
            "Mình đang nấu ăn ở nhà bét."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 36.358917,
        "end": 37.918917,
        "correctAnswer": "Anh ấy đang ở đâu?",
        "translation": "他现在在哪儿？",
        "options": [
            "Anh ấy đang ở đau?",
            "Ánh ấy đang ở đâu?",
            "Anh ấy đang ở đâu?",
            "Anh ấy đạng ở đâu?"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 38.528917,
        "end": 41.328917,
        "correctAnswer": "Anh ấy đang xem đá bóng tại văn phòng.",
        "translation": "他正在办公室看足球。",
        "options": [
            "Anh ấy đang xem đã bóng tại văn phòng.",
            "Anh ấy đang xem đá bóng tại văn phòng.",
            "Anh ấy đang xem đá bóng tại văng phòng.",
            "Anh ẩy đang xem đá bóng tại văn phòng."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 42.478917,
        "end": 44.058917,
        "correctAnswer": "Trên bàn có gì?",
        "translation": "桌子上有什么？",
        "options": [
            "Trên bàn có dì?",
            "Trên bàng có gì?",
            "Trên bàn có gì?",
            "Trên bàn cố gì?"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 44.668917,
        "end": 46.808917,
        "correctAnswer": "Trên bàn có sách và bút.",
        "translation": "桌子上有书和笔。",
        "options": [
            "Trên bàn có sách và bút.",
            "Trên bàn có sác và bút.",
            "Trên bàn có sách và bụt.",
            "Trên bàng có sách và bút."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 47.608917,
        "end": 49.198917,
        "correctAnswer": "Dưới bàn có gì?",
        "translation": "桌子下面有什么？",
        "options": [
            "Dưới bàn có dì?",
            "Dưới bàn có gì?",
            "Dưới bàng có gì?",
            "Dưới bàn cố gì?"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 49.878917,
        "end": 51.788917,
        "correctAnswer": "Dưới bàn có con mèo.",
        "translation": "桌子下面有一只猫。",
        "options": [
            "Dưới bàn có con méo.",
            "Dưới bàn có con mèo.",
            "Dưới bàn có côn mèo.",
            "Dưới bàng có con mèo."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 52.948917,
        "end": 54.858917,
        "correctAnswer": "Trong cặp của bạn có gì?",
        "translation": "你书包里有什么？",
        "options": [
            "Trong cặp của bạn cố gì?",
            "Trong cặp của bản có gì?",
            "Trong cặp của bạn có dì?",
            "Trong cặp của bạn có gì?"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 55.638917,
        "end": 57.988917,
        "correctAnswer": "Trong cặp tôi có sách và bút.",
        "translation": "我的书包里有书和笔。",
        "options": [
            "Trong cặp tôi có sác và bút.",
            "Trong cặp tôi có sách và bụt.",
            "Trong cặp tôi có sách và bút.",
            "Trong cặp tôi cố sách và bút."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 59.188917,
        "end": 60.728917,
        "correctAnswer": "Trong phòng có ai?",
        "translation": "房间里有人吗？",
        "options": [
            "Trong phồng có ai?",
            "Trong phòng có ái?",
            "Trong phòng có ai?",
            "Trong phòng có ãi?"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 61.418917,
        "end": 63.078917,
        "correctAnswer": "Trong phòng không có ai.",
        "translation": "房间里没有人。",
        "options": [
            "Trong phòng không có ãi.",
            "Trong phòng không có ai.",
            "Trong phòng khong có ai.",
            "Trong phồng không có ai."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 64.208917,
        "end": 66.358917,
        "correctAnswer": "Ngoài đường có xe máy không?",
        "translation": "外面有摩托车吗？",
        "options": [
            "Ngoài đường có xê máy không?",
            "Ngoài đường có xe mái không?",
            "Ngoài đường có xe máy không?",
            "Ngoài đường có xe mảy không?"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 67.338917,
        "end": 70.488917,
        "correctAnswer": "Có, ngoài đường có rất nhiều xe máy.",
        "translation": "有，外面有很多摩托车。",
        "options": [
            "Có, ngoài đường có rấc nhiều xe máy.",
            "Có, ngoài đường có rất nhiều xê máy.",
            "Có, ngoài đường có rất nhiều xe máy.",
            "Có, ngoài đường có rất nhiểu xe máy."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 71.338917,
        "end": 72.938917,
        "correctAnswer": "Ai đứng trước bạn đấy?",
        "translation": "谁站在你前面呢？",
        "options": [
            "Ai đứng trướt bạn đấy?",
            "Ai đứng trước bạn đấy?",
            "Ai đứng trước bạn đáy?",
            "Ai đứng chuớc bạn đấy?"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 73.638917,
        "end": 75.418917,
        "correctAnswer": "Anh Ba đứng trước tôi.",
        "translation": "(阿)三哥哥站在我前面。",
        "options": [
            "Anh Ba đứng trước tôi.",
            "Anh Ba đứng chuớc tôi.",
            "Anh Ba đứng trướt tôi.",
            "Ánh Ba đứng trước tôi."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 76.098917,
        "end": 78.088917,
        "correctAnswer": "Chị Ly đứng sau tôi.",
        "translation": "(阿)丽姐姐站在我后面。",
        "options": [
            "Chị Ly đứng sầu tôi.",
            "Chị Ly đứng sau tôi.",
            "Chị Ly đứng xau tôi.",
            "Chị Ly đứng xâu tôi."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 78.998917,
        "end": 81.078917,
        "correctAnswer": "Ông Tú đứng cạnh tôi.",
        "translation": "(阿)秀爷爷站在我旁边。",
        "options": [
            "Ông Tú đứng cạnh tôi.",
            "Ông Tú đứng kạnh tôi.",
            "Ông Tú đứng cạnh tui.",
            "Ông Tũ đứng cạnh tôi."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 82.088917,
        "end": 84.638917,
        "correctAnswer": "Tôi đứng giữa Ông Tú và bà Sa.",
        "translation": "我站在(阿)秀爷爷和(阿)莎奶奶的中间。",
        "options": [
            "Tôi đứng giữa Ông Tú và bà Sa.",
            "Tôi đứng giứa Ông Tú và bà Sa.",
            "Tôi đứng giữa Ông Tú và bà Xa.",
            "Tôi đứng giữa Ông Tũ và bà Sa."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 85.968917,
        "end": 87.318917,
        "correctAnswer": "Cô ấy đẹp nhỉ?",
        "translation": "她很漂亮，对吧？",
        "options": [
            "Cô ấy đẹp nhỉ?",
            "Cô ấy đẹp nhỉ.",
            "Cô ấy đep nhỉ?",
            "Cô ẩy đẹp nhỉ?"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 87.958917,
        "end": 89.878917,
        "correctAnswer": "Ừ, cô ấy rất đẹp.",
        "translation": "嗯，她非常漂亮。",
        "options": [
            "Ừ, cô ấy rất đep.",
            "Ừ, cô ấy rất đẹp.",
            "Ừ, cô ấy rấc đẹp.",
            "Ừ, cô ẩy rất đẹp."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 90.668917,
        "end": 92.238917,
        "correctAnswer": "Anh ấy nóng tính nhỉ?",
        "translation": "他脾气很急，对吧？",
        "options": [
            "Ánh ấy nóng tính nhỉ?",
            "Anh ấy nóng tĩnh nhỉ?",
            "Anh ấy nóng tính nhỉ?",
            "Anh ấy nống tính nhỉ?"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 92.778917,
        "end": 95.318917,
        "correctAnswer": "Đúng, anh ấy rất nóng tính.",
        "translation": "对，他非常急性子。",
        "options": [
            "Đúng, anh ấy rất nóng tính.",
            "Đúng, anh ấy rất nống tính.",
            "Đúng, anh ấy rất nóng tĩnh.",
            "Đúng, ánh ấy rất nóng tính."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 95.988917,
        "end": 97.298917,
        "correctAnswer": "Trời nóng nhỉ?",
        "translation": "天气热，对吧？",
        "options": [
            "Trời nóng nhỉ?",
            "Trời nóng nhị?",
            "Trời núng nhỉ?",
            "Trời núng nhị?"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 97.998917,
        "end": 100.038917,
        "correctAnswer": "Ừ, trời nóng quá.",
        "translation": "嗯，天气太热了。",
        "options": [
            "Ừ, trời nóng quá.",
            "Ừ, trời nóng quã.",
            "Ừ, trời nống quá.",
            "Ừ, trồi nóng quá."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 100.798917,
        "end": 102.298917,
        "correctAnswer": "Trong xe có ai?",
        "translation": "车里有人吗？",
        "options": [
            "Trong xe có ái?",
            "Trong xe có ai?",
            "Trong xê có ai?",
            "Trong xe cố ai?"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 103.008917,
        "end": 104.758917,
        "correctAnswer": "Trong cặp có cái gì?",
        "translation": "书包里有什么东西？",
        "options": [
            "Trong cặp có cái gì?",
            "Trong cặp có cái gí?",
            "Trong cặp có cãi gì?",
            "Trong cạp có cái gì?"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 105.398917,
        "end": 107.588917,
        "correctAnswer": "Trong cốp xe có con gì?",
        "translation": "后备箱里有动物吗？",
        "options": [
            "Trong cốp xe có côn gì?",
            "Trong cốp xe có con gì?",
            "Trong cốp xê có con gì?",
            "Trong cốp xe có con gí?"
        ]
    }
];

        let currentIndex = 0;
        let isFreeMode = true;
        let correctCount = 0;
        let isPlaying = false;
        let correctSentences = new Set();
        let wrongSentences = new Set();
        let autoContinue = false;
        let showAnswer = false;
        let userAnswers = [];

        // Fisher-Yates shuffle algorithm
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function init() {
            updateSentenceDisplay();
        }

        function updateSentenceDisplay() {
            sentenceNumber.value = currentIndex + 1;
            indicator.style.background = '#ffffe0';
            if (isFreeMode && showAnswer) {
                indicator.innerHTML = `
                    <div style="font-size: 18px; font-weight: bold; color: #85ae5f;">${sentences[currentIndex].translation}</div>
                `;
            } else {
                indicator.innerHTML = '';
            }
            updateOptions();
            if (!isFreeMode) updateScore();
        }

        function updateOptions() {
            optionsContainer.innerHTML = '';
            const shuffledOptions = shuffleArray(sentences[currentIndex].options);
            shuffledOptions.forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'optionBtn';
                btn.textContent = option;
                btn.onclick = () => checkAnswer(option);
                optionsContainer.appendChild(btn);
            });
        }

        function playCurrentSentence() {
            if (isPlaying) audio.pause();
            buttons.forEach(btn => btn.classList.add('disabled'));
            sentenceNumber.disabled = true;
            isPlaying = true;
            audio.src = sentences[currentIndex].audioFile;
            audio.currentTime = sentences[currentIndex].start;
            audio.play().catch(error => {
                console.error('Audio playback failed:', error);
                alert('Vui lòng nhấn nút “再听一遍” để phát âm thanh.');
                buttons.forEach(btn => btn.classList.remove('disabled'));
                sentenceNumber.disabled = false;
                isPlaying = false;
            });

            audio.ontimeupdate = () => {
                if (audio.currentTime >= sentences[currentIndex].end) {
                    audio.pause();
                    audio.ontimeupdate = null;
                    buttons.forEach(btn => btn.classList.remove('disabled'));
                    sentenceNumber.disabled = false;
                    isPlaying = false;
                }
            };
        }

        function moveSentence(direction) {
            currentIndex = (currentIndex + direction + sentences.length) % sentences.length;
            updateSentenceDisplay();
            playCurrentSentence();
        }

        function checkAnswer(selectedAnswer) {
            const correctAnswer = sentences[currentIndex].correctAnswer;
            const optionButtons = optionsContainer.getElementsByClassName('optionBtn');
            
            // Clear previous styles
            for (let btn of optionButtons) {
                btn.classList.remove('correct', 'wrong');
                btn.disabled = !isFreeMode; // Only disable buttons in Test Mode
            }

            // Find and style the selected button
            for (let btn of optionButtons) {
                if (btn.textContent === selectedAnswer) {
                    if (selectedAnswer === correctAnswer) {
                        indicator.style.background = '#B7D7AA';
                                                indicator.innerHTML = `
                    <div style="font-size: 18px; font-weight: bold; color: #000000;">${sentences[currentIndex].translation}</div>
                `;
                        btn.classList.add('correct');
                        correctAudio.play().catch(error => {
                            console.error('Correct audio playback failed:', error);
                        });
                    } else {
                        indicator.style.background = '#CE6D5E';
                                                indicator.innerHTML = `
                    <div style="font-size: 18px; font-weight: bold; color: #000000;">${sentences[currentIndex].translation}</div>
                `;
                        btn.classList.add('wrong');
                        wrongAudio.play().catch(error => {
                            console.error('Wrong audio playback failed:', error);
                        });
                    }
                }
            }

            if (!isFreeMode) {
                userAnswers[currentIndex] = selectedAnswer;
                if (selectedAnswer === correctAnswer && !correctSentences.has(currentIndex)) {
                    correctCount++;
                    correctSentences.add(currentIndex);
                    wrongSentences.delete(currentIndex);
                } else if (selectedAnswer !== correctAnswer && !correctSentences.has(currentIndex)) {
                    wrongSentences.add(currentIndex);
                }
                updateScore();

                // Auto-move to next sentence in Test Mode
                const audioToWait = (selectedAnswer === correctAnswer) ? correctAudio : wrongAudio;
                audioToWait.onended = () => {
                    if (userAnswers.length === sentences.length) {
                        showResults();
                    } else {
                        setTimeout(() => {
                            moveSentence(1);
                        }, 200);
                    }
                };
            } else if (isFreeMode && autoContinue && selectedAnswer === correctAnswer) {
                // Auto-move in Free Mode only if answer is correct and autoContinue is enabled
                correctAudio.onended = () => {
                    setTimeout(() => {
                        moveSentence(1);
                    }, 200);
                };
            } else {
                correctAudio.onended = null;
                wrongAudio.onended = null;
            }
        }

        function updateScore() {
            scoreDisplay.textContent = `${correctCount}/${sentences.length}`;
            scoreDisplay.style.display = 'block'; // Hiển thị score trong Test Mode
        }

        function showResults() {
            let resultText = `练习完成！\n正确答案数量：${correctCount}/${sentences.length}\n正确率：${((correctCount / sentences.length) * 100).toFixed(2)}%\n错误题目：`;
            wrongSentences.forEach(index => {
                resultText += `\n第${index + 1}题：\n你的选择：${userAnswers[index] || '未选择'}\n正确答案：${sentences[index].correctAnswer}\n`;
            });
            if (wrongSentences.size === 0) {
                resultText += '\n全部正确！';
            }
            resultsDisplay.textContent = resultText;
            resultsDisplay.style.display = 'block';
        }

        prevBtn.onclick = () => {
            moveSentence(-1);
        };

        nextBtn.onclick = () => {
            moveSentence(1);
        };

        replayBtn.onclick = () => {
            playCurrentSentence();
        };

        freeModeBtn.onclick = () => {
            isFreeMode = true;
            freeModeBtn.classList.add('active-mode');
            testModeBtn.classList.remove('active-mode');
            autoContinueBtn.disabled = false;
            autoContinueBtn.classList.remove('disabled');
            showHideBtn.disabled = false;
            showHideBtn.classList.remove('disabled');
            scoreDisplay.style.display = 'none';
            wrongSentencesDisplay.style.display = 'none';
            resultsDisplay.style.display = 'none';
            updateSentenceDisplay();
        };

        testModeBtn.onclick = () => {
            isFreeMode = false;
            testModeBtn.classList.add('active-mode');
            freeModeBtn.classList.remove('active-mode');
            autoContinueBtn.disabled = true;
            autoContinueBtn.classList.add('disabled');
            showHideBtn.disabled = true;
            showHideBtn.classList.add('disabled');
            showHideBtn.classList.remove('active-mode');
            showAnswer = false;
            scoreDisplay.style.display = 'block';
            currentIndex = 0;
            correctCount = 0;
            correctSentences.clear();
            wrongSentences.clear();
            userAnswers = [];
            for (let i = 0; i < sentences.length; i++) {
                wrongSentences.add(i);
            }
            updateSentenceDisplay();
        };

        autoContinueBtn.onclick = () => {
            if (isFreeMode) {
                autoContinue = !autoContinue;
                autoContinueBtn.classList.toggle('active-mode');
                if (!autoContinue) {
                    correctAudio.onended = null;
                }
            }
        };

        showHideBtn.onclick = () => {
            if (isFreeMode) {
                showAnswer = !showAnswer;
                showHideBtn.classList.toggle('active-mode');
                updateSentenceDisplay();
            }
        };

        sentenceNumber.onchange = () => {
            if (!isPlaying) {
                const num = parseInt(sentenceNumber.value) - 1;
                if (!isNaN(num) && num >= 0 && num < sentences.length) {
                    currentIndex = num;
                    updateSentenceDisplay();
                    playCurrentSentence();
                } else {
                    alert(`输入范围： 1 到 ${sentences.length}`);
                    updateSentenceDisplay();
                }
            }
        };

        sentenceNumber.onkeydown = (e) => {
            if (!isPlaying) {
                if (e.key === 'ArrowLeft') {
                    moveSentence(-1);
                }
                if (e.key === 'ArrowRight') {
                    moveSentence(1);
                }
            }
        };

        init();
    </script>
</body>
</html>